
// require the library, main export is a function
const simpleGit = require('simple-git');
const fs = require('fs');
const tmp = require('tmp');

async function main() {

	// Get all new issues
	// If there are new issues
	// Extract CVE json details
	// Checkout CVE repo
	// Get the next CVE ID
	// Write CVE json to CVE file
	// Commit file
	// Update the issue summary, add a comment, and remove label
	// If the issue is a candidate, add the candidate label


	var filename = 'test-CVE6.json';
	var tmpObj = tmp.dirSync({unsafeCleanup: true});
	var tmpDir = tmpObj.name;

	var git = simpleGit();
	await git.clone('https://github.com/distributedweaknessfiling/test-bot-repo.git', tmpDir)

	var gitrepo = simpleGit(tmpDir);
	process.chdir(tmpDir);

	var cve_data = {
		id: 'CVE-1907-0002',
		description: 'Something bad happened',
	};

	var json_data = JSON.stringify(cve_data, null, '  ');

	fs.writeFileSync(filename, json_data);

	await gitrepo.add(filename);
	await gitrepo.commit("Add a CVE");
	await gitrepo.push();

	tmpObj.removeCallback();

}

if (require.main === module) {
  main();
}
